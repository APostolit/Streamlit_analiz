import streamlit as st
import pandas as pd
import requests
import json

# –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º
@st.cache_data
def get_data(group_type):
    try:
        # –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ URL –∞–¥—Ä–µ—Å–∞
        url = f"https://www.imf.org/external/datamapper/api/v1/{group_type}"
        # –ó–∞–ø—Ä–æ—Å –∫ API
        response = requests.get(url)
        # –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –∏–∑ —Ñ–æ—Ä–º–∞—Ç–∞ JSON
        resp_txt = json.loads(response.text)
        # –†–∞–∑–±–æ—Ä –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        results = [
            {"id": key, **values} for key, values in resp_txt[group_type].items()
        ]
        # –°–æ–∑–¥–∞–Ω–∏–µ DataFrame
        df = pd.DataFrame.from_records(results)
        return df
    except Exception as e:
        st.error(f'–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö: {e}', icon="üö®")

st.subheader('üåç–ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ —Ä–µ–≥–∏–æ–Ω–æ–≤ –ú–í–§ (IMF)üè¶')

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫—Ä—É–≥–æ–≤–æ–π —Å–ø–∏–Ω–Ω–µ—Ä
with st.spinner(text="üì•–ñ–¥–∏—Ç–µ, –∏–¥–µ—Ç –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...", show_time=True):
    # –ì—Ä—É–ø–ø—ã
    df_g = get_data('groups')
    # –†–µ–≥–∏–æ–Ω—ã
    df_r = get_data('regions')
    # –°—Ç—Ä–∞–Ω—ã
    df_c = get_data('countries')

# –í–∫–ª–∞–¥–∫–∏ –≤–µ—Ä—Ö–Ω–µ–≥–æ —É—Ä–æ–≤–Ω—è
tb1, tb2, tb3 = st.tabs([
    "üåêüìà–ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –≥—Ä—É–ø–ø—ã",
    "üåêüóæ–ì–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ —Ä–µ–≥–∏–æ–Ω—ã",
    "üåêüèôÔ∏è–°—Ç—Ä–∞–Ω—ã"
    ])

# –í–∫–ª–∞–¥–∫–∞ —Å –¥–∞–Ω–Ω—ã–º–∏ –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö –≥—Ä—É–ø–ø ----------------
with tb1:
    st.markdown('#### üåêüìà–ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –≥—Ä—É–ø–ø—ã')
    # –°–æ–∑–¥–∞–µ–º –≤–∫–ª–∞–¥–∫–∏ –¥–ª—è –¥–∞–Ω–Ω—ã—Ö
    t1, t2 = st.tabs([
        "üìÉ–°—Ç–æ–ª–±—Ü—ã –Ω–∞–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö",
        "üì∂–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã –∏ –º–µ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö"
        ])
    # –í–∫–ª–∞–¥–∫–∞ —Å –¥–∞–Ω–Ω—ã–º–∏
    with t1:
        st.markdown('##### üìñ–ò–º–µ–Ω–∞ —Å—Ç–æ–ª–±—Ü–æ–≤')
        # –°–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
        with st.container(width=200):
            st.write(df_g.columns)

    # –í–∫–ª–∞–¥–∫–∞ —Å –¥–∞–Ω–Ω—ã–º–∏
    with t2:
        st.markdown('##### üì∂–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã –∏ –º–µ—Ç–∫–∏ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö –≥—Ä—É–ø–ø –≤ API –ú–í–§')
        # –°–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
        with st.container(width=500):
            st.write(df_g)

# –í–∫–ª–∞–¥–∫–∞ —Å –¥–∞–Ω–Ω—ã–º–∏ –¥–ª—è –≥–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏—Ö —Ä–µ–≥–∏–æ–Ω–æ–≤ ----------------
with tb2:
    st.subheader('üåêüóæ–†–µ–≥–∏–æ–Ω—ã (–∫–æ–Ω—Ç–∏–Ω–µ–Ω—Ç—ã)')
    # –°–æ–∑–¥–∞–µ–º –≤–∫–ª–∞–¥–∫–∏ –¥–ª—è –¥–∞–Ω–Ω—ã—Ö
    t1, t2 = st.tabs([
        "üìÉ–°—Ç–æ–ª–±—Ü—ã –Ω–∞–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö",
        "üì∂–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã –∏ –º–µ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö"
        ])
    # –í–∫–ª–∞–¥–∫–∞ —Å –¥–∞–Ω–Ω—ã–º–∏
    with t1:
        st.markdown('##### üìñ–ò–º–µ–Ω–∞ —Å—Ç–æ–ª–±—Ü–æ–≤')
        # –°–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
        with st.container(width=200):
            st.write(df_r.columns)

    # –í–∫–ª–∞–¥–∫–∞ —Å –¥–∞–Ω–Ω—ã–º–∏
    with t2:
        st.markdown('##### üì∂–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã –∏ –º–µ—Ç–∫–∏ –≥–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏—Ö —Ä–µ–≥–∏–æ–Ω–æ–≤ –≤ API –ú–í–§')
        # –°–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
        with st.container(width=500):
            st.write(df_r)

# –í–∫–ª–∞–¥–∫–∞ —Å –¥–∞–Ω–Ω—ã–º–∏ –¥–ª—è —Å—Ç—Ä–∞–Ω-------------------
with tb3:
    st.subheader('üåêüèôÔ∏è–°—Ç—Ä–∞–Ω—ã')
    # –°–æ–∑–¥–∞–µ–º –≤–∫–ª–∞–¥–∫–∏ –¥–ª—è –¥–∞–Ω–Ω—ã—Ö
    t1, t2 = st.tabs([
        "üìÉ–°—Ç–æ–ª–±—Ü—ã –Ω–∞–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö",
        "üì∂–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã –∏ –º–µ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö"
        ])
    # –í–∫–ª–∞–¥–∫–∞ —Å –¥–∞–Ω–Ω—ã–º–∏
    with t1:
        st.markdown('##### üìñ–ò–º–µ–Ω–∞ —Å—Ç–æ–ª–±—Ü–æ–≤')
        # –°–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
        with st.container(width=200):
            st.write(df_c.columns)

    # –í–∫–ª–∞–¥–∫–∞ —Å –¥–∞–Ω–Ω—ã–º–∏
    with t2:
        st.markdown('##### üì∂–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã –∏ –º–µ—Ç–∫–∏ —Å—Ç—Ä–∞–Ω –≤ API –ú–í–§')
        # –°–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
        with st.container(width=500):
            st.write(df_c)